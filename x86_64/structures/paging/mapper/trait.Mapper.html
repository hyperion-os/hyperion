<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A trait for common page table operations on pages of size `S`."><title>Mapper in x86_64::structures::paging::mapper - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="x86_64" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0-nightly (3a85a5cfe 2023-11-20)" data-channel="nightly" data-search-js="search-d23a059ec093b287.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../../static.files/main-f06f02fd918e3bb3.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../x86_64/index.html">x86_64</a><span class="version">0.14.11</span></h2></div><h2 class="location"><a href="#">Mapper</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.map_to_with_table_flags">map_to_with_table_flags</a></li><li><a href="#tymethod.set_flags_p2_entry">set_flags_p2_entry</a></li><li><a href="#tymethod.set_flags_p3_entry">set_flags_p3_entry</a></li><li><a href="#tymethod.set_flags_p4_entry">set_flags_p4_entry</a></li><li><a href="#tymethod.translate_page">translate_page</a></li><li><a href="#tymethod.unmap">unmap</a></li><li><a href="#tymethod.update_flags">update_flags</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.identity_map">identity_map</a></li><li><a href="#method.map_to">map_to</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In x86_64::structures::paging::mapper</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../../../index.html">x86_64</a>::<wbr><a href="../../index.html">structures</a>::<wbr><a href="../index.html">paging</a>::<wbr><a href="index.html">mapper</a>::<wbr><a class="trait" href="#">Mapper</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#110-375">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait Mapper&lt;S: <a class="trait" href="../page/trait.PageSize.html" title="trait x86_64::structures::paging::page::PageSize">PageSize</a>&gt; {
    // Required methods
    unsafe fn <a href="#tymethod.map_to_with_table_flags" class="fn">map_to_with_table_flags</a>&lt;A&gt;(
        &amp;mut self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
        frame: <a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;,
        flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
        parent_table_flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
        frame_allocator: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;mut A</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.MapToError.html" title="enum x86_64::structures::paging::mapper::MapToError">MapToError</a>&lt;S&gt;&gt;
       <span class="where">where Self: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,
             A: <a class="trait" href="../trait.FrameAllocator.html" title="trait x86_64::structures::paging::FrameAllocator">FrameAllocator</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></span>;
<span class="item-spacer"></span>    fn <a href="#tymethod.unmap" class="fn">unmap</a>(
        &amp;mut self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;, <a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;), <a class="enum" href="enum.UnmapError.html" title="enum x86_64::structures::paging::mapper::UnmapError">UnmapError</a>&gt;;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.update_flags" class="fn">update_flags</a>(
        &amp;mut self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
        flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.set_flags_p4_entry" class="fn">set_flags_p4_entry</a>(
        &amp;mut self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
        flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlushAll.html" title="struct x86_64::structures::paging::mapper::MapperFlushAll">MapperFlushAll</a>, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.set_flags_p3_entry" class="fn">set_flags_p3_entry</a>(
        &amp;mut self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
        flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlushAll.html" title="struct x86_64::structures::paging::mapper::MapperFlushAll">MapperFlushAll</a>, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.set_flags_p2_entry" class="fn">set_flags_p2_entry</a>(
        &amp;mut self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
        flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlushAll.html" title="struct x86_64::structures::paging::mapper::MapperFlushAll">MapperFlushAll</a>, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.translate_page" class="fn">translate_page</a>(
        &amp;self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;, <a class="enum" href="enum.TranslateError.html" title="enum x86_64::structures::paging::mapper::TranslateError">TranslateError</a>&gt;;

    // Provided methods
    unsafe fn <a href="#method.map_to" class="fn">map_to</a>&lt;A&gt;(
        &amp;mut self,
        page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
        frame: <a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;,
        flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
        frame_allocator: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;mut A</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.MapToError.html" title="enum x86_64::structures::paging::mapper::MapToError">MapToError</a>&lt;S&gt;&gt;
       <span class="where">where Self: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,
             A: <a class="trait" href="../trait.FrameAllocator.html" title="trait x86_64::structures::paging::FrameAllocator">FrameAllocator</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></span> { ... }
<span class="item-spacer"></span>    unsafe fn <a href="#method.identity_map" class="fn">identity_map</a>&lt;A&gt;(
        &amp;mut self,
        frame: <a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;,
        flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
        frame_allocator: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;mut A</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.MapToError.html" title="enum x86_64::structures::paging::mapper::MapToError">MapToError</a>&lt;S&gt;&gt;
       <span class="where">where Self: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a> + <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;S&gt;,
             A: <a class="trait" href="../trait.FrameAllocator.html" title="trait x86_64::structures::paging::FrameAllocator">FrameAllocator</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,
             S: <a class="trait" href="../page/trait.PageSize.html" title="trait x86_64::structures::paging::page::PageSize">PageSize</a></span> { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A trait for common page table operations on pages of size <code>S</code>.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.map_to_with_table_flags" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#270-280">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.map_to_with_table_flags" class="fn">map_to_with_table_flags</a>&lt;A&gt;(
    &amp;mut self,
    page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
    frame: <a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;,
    flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
    parent_table_flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
    frame_allocator: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;mut A</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.MapToError.html" title="enum x86_64::structures::paging::mapper::MapToError">MapToError</a>&lt;S&gt;&gt;<span class="where fmt-newline">where
    Self: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,
    A: <a class="trait" href="../trait.FrameAllocator.html" title="trait x86_64::structures::paging::FrameAllocator">FrameAllocator</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</span></h4></section></summary><div class="docblock"><p>Creates a new mapping in the page table.</p>
<p>This function might need additional physical frames to create new page tables. These
frames are allocated from the <code>allocator</code> argument. At most three frames are required.</p>
<p>The flags of the parent table(s) can be explicitly specified. Those flags are used for
newly created table entries, and for existing entries the flags are added.</p>
<p>Depending on the used mapper implementation, the <code>PRESENT</code> and <code>WRITABLE</code> flags might
be set for parent tables, even if they are not specified in <code>parent_table_flags</code>.</p>
<h6 id="safety"><a href="#safety">Safety</a></h6>
<p>Creating page table mappings is a fundamentally unsafe operation because
there are various ways to break memory safety through it. For example,
re-mapping an in-use page to a different frame changes and invalidates
all values stored in that page, resulting in undefined behavior on the
next use.</p>
<p>The caller must ensure that no undefined behavior or memory safety
violations can occur through the new mapping. Among other things, the
caller must prevent the following:</p>
<ul>
<li>Aliasing of <code>&amp;mut</code> references, i.e. two <code>&amp;mut</code> references that point to
the same physical address. This is undefined behavior in Rust.
<ul>
<li>This can be ensured by mapping each page to an individual physical
frame that is not mapped anywhere else.</li>
</ul>
</li>
<li>Creating uninitialized or invalid values: Rust requires that all values
have a correct memory layout. For example, a <code>bool</code> must be either a 0
or a 1 in memory, but not a 3 or 4. An exception is the <code>MaybeUninit</code>
wrapper type, which abstracts over possibly uninitialized memory.
<ul>
<li>This is only a problem when re-mapping pages to different physical
frames. Mapping a page that is not in use yet is fine.</li>
</ul>
</li>
</ul>
<p>Special care must be taken when sharing pages with other address spaces,
e.g. by setting the <code>GLOBAL</code> flag. For example, a global mapping must be
the same in all address spaces, otherwise undefined behavior can occur
because of TLB races. It’s worth noting that all the above requirements
also apply to shared mappings, including the aliasing requirements.</p>
<h5 id="examples"><a href="#examples">Examples</a></h5>
<p>Create USER_ACCESSIBLE | NO_EXECUTE | NO_CACHE mapping and update
the top hierarchy only with USER_ACCESSIBLE:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>        mapper
          .map_to_with_table_flags(
              page,
              frame,
             PageTableFlags::PRESENT
                  | PageTableFlags::WRITABLE
                  | PageTableFlags::USER_ACCESSIBLE
                  | PageTableFlags::NO_EXECUTE
                  | PageTableFlags::NO_CACHE,
             PageTableFlags::USER_ACCESSIBLE,
              frame_allocator,
          )
          .unwrap()
          .flush();</code></pre></div>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.unmap" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#285">source</a><h4 class="code-header">fn <a href="#tymethod.unmap" class="fn">unmap</a>(
    &amp;mut self,
    page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;, <a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;), <a class="enum" href="enum.UnmapError.html" title="enum x86_64::structures::paging::mapper::UnmapError">UnmapError</a>&gt;</h4></section></summary><div class="docblock"><p>Removes a mapping from the page table and returns the frame that used to be mapped.</p>
<p>Note that no page tables or pages are deallocated.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.update_flags" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#296-300">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.update_flags" class="fn">update_flags</a>(
    &amp;mut self,
    page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
    flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;</h4></section></summary><div class="docblock"><p>Updates the flags of an existing mapping.</p>
<h6 id="safety-1"><a href="#safety-1">Safety</a></h6>
<p>This method is unsafe because changing the flags of a mapping
might result in undefined behavior. For example, setting the
<code>GLOBAL</code> and <code>MUTABLE</code> flags for a page might result in the corruption
of values stored in that page from processes running in other address
spaces.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_flags_p4_entry" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#311-315">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.set_flags_p4_entry" class="fn">set_flags_p4_entry</a>(
    &amp;mut self,
    page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
    flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlushAll.html" title="struct x86_64::structures::paging::mapper::MapperFlushAll">MapperFlushAll</a>, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;</h4></section></summary><div class="docblock"><p>Set the flags of an existing page level 4 table entry</p>
<h6 id="safety-2"><a href="#safety-2">Safety</a></h6>
<p>This method is unsafe because changing the flags of a mapping
might result in undefined behavior. For example, setting the
<code>GLOBAL</code> and <code>WRITABLE</code> flags for a page might result in the corruption
of values stored in that page from processes running in other address
spaces.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_flags_p3_entry" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#326-330">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.set_flags_p3_entry" class="fn">set_flags_p3_entry</a>(
    &amp;mut self,
    page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
    flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlushAll.html" title="struct x86_64::structures::paging::mapper::MapperFlushAll">MapperFlushAll</a>, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;</h4></section></summary><div class="docblock"><p>Set the flags of an existing page table level 3 entry</p>
<h6 id="safety-3"><a href="#safety-3">Safety</a></h6>
<p>This method is unsafe because changing the flags of a mapping
might result in undefined behavior. For example, setting the
<code>GLOBAL</code> and <code>WRITABLE</code> flags for a page might result in the corruption
of values stored in that page from processes running in other address
spaces.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_flags_p2_entry" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#341-345">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.set_flags_p2_entry" class="fn">set_flags_p2_entry</a>(
    &amp;mut self,
    page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
    flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlushAll.html" title="struct x86_64::structures::paging::mapper::MapperFlushAll">MapperFlushAll</a>, <a class="enum" href="enum.FlagUpdateError.html" title="enum x86_64::structures::paging::mapper::FlagUpdateError">FlagUpdateError</a>&gt;</h4></section></summary><div class="docblock"><p>Set the flags of an existing page table level 2 entry</p>
<h6 id="safety-4"><a href="#safety-4">Safety</a></h6>
<p>This method is unsafe because changing the flags of a mapping
might result in undefined behavior. For example, setting the
<code>GLOBAL</code> and <code>WRITABLE</code> flags for a page might result in the corruption
of values stored in that page from processes running in other address
spaces.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.translate_page" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#351">source</a><h4 class="code-header">fn <a href="#tymethod.translate_page" class="fn">translate_page</a>(&amp;self, page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;, <a class="enum" href="enum.TranslateError.html" title="enum x86_64::structures::paging::mapper::TranslateError">TranslateError</a>&gt;</h4></section></summary><div class="docblock"><p>Return the frame that the specified page is mapped to.</p>
<p>This function assumes that the page is mapped to a frame of size <code>S</code> and returns an
error otherwise.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.map_to" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#179-198">source</a><h4 class="code-header">unsafe fn <a href="#method.map_to" class="fn">map_to</a>&lt;A&gt;(
    &amp;mut self,
    page: <a class="struct" href="../page/struct.Page.html" title="struct x86_64::structures::paging::page::Page">Page</a>&lt;S&gt;,
    frame: <a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;,
    flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
    frame_allocator: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;mut A</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.MapToError.html" title="enum x86_64::structures::paging::mapper::MapToError">MapToError</a>&lt;S&gt;&gt;<span class="where fmt-newline">where
    Self: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,
    A: <a class="trait" href="../trait.FrameAllocator.html" title="trait x86_64::structures::paging::FrameAllocator">FrameAllocator</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</span></h4></section></summary><div class="docblock"><p>Creates a new mapping in the page table.</p>
<p>This function might need additional physical frames to create new page tables. These
frames are allocated from the <code>allocator</code> argument. At most three frames are required.</p>
<p>Parent page table entries are automatically updated with <code>PRESENT | WRITABLE | USER_ACCESSIBLE</code>
if present in the <code>PageTableFlags</code>. Depending on the used mapper implementation
the <code>PRESENT</code> and <code>WRITABLE</code> flags might be set for parent tables,
even if they are not set in <code>PageTableFlags</code>.</p>
<p>The <code>map_to_with_table_flags</code> method gives explicit control over the parent page table flags.</p>
<h6 id="safety-5"><a href="#safety-5">Safety</a></h6>
<p>Creating page table mappings is a fundamentally unsafe operation because
there are various ways to break memory safety through it. For example,
re-mapping an in-use page to a different frame changes and invalidates
all values stored in that page, resulting in undefined behavior on the
next use.</p>
<p>The caller must ensure that no undefined behavior or memory safety
violations can occur through the new mapping. Among other things, the
caller must prevent the following:</p>
<ul>
<li>Aliasing of <code>&amp;mut</code> references, i.e. two <code>&amp;mut</code> references that point to
the same physical address. This is undefined behavior in Rust.
<ul>
<li>This can be ensured by mapping each page to an individual physical
frame that is not mapped anywhere else.</li>
</ul>
</li>
<li>Creating uninitialized or invalid values: Rust requires that all values
have a correct memory layout. For example, a <code>bool</code> must be either a 0
or a 1 in memory, but not a 3 or 4. An exception is the <code>MaybeUninit</code>
wrapper type, which abstracts over possibly uninitialized memory.
<ul>
<li>This is only a problem when re-mapping pages to different physical
frames. Mapping a page that is not in use yet is fine.</li>
</ul>
</li>
</ul>
<p>Special care must be taken when sharing pages with other address spaces,
e.g. by setting the <code>GLOBAL</code> flag. For example, a global mapping must be
the same in all address spaces, otherwise undefined behavior can occur
because of TLB races. It’s worth noting that all the above requirements
also apply to shared mappings, including the aliasing requirements.</p>
<h5 id="examples-1"><a href="#examples-1">Examples</a></h5>
<p>Create a USER_ACCESSIBLE mapping:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>        mapper
          .map_to(
              page,
              frame,
             PageTableFlags::PRESENT
                  | PageTableFlags::WRITABLE
                  | PageTableFlags::USER_ACCESSIBLE,
              frame_allocator,
          )
          .unwrap()
          .flush();</code></pre></div>
</div></details><details class="toggle method-toggle" open><summary><section id="method.identity_map" class="method"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mod.rs.html#360-374">source</a><h4 class="code-header">unsafe fn <a href="#method.identity_map" class="fn">identity_map</a>&lt;A&gt;(
    &amp;mut self,
    frame: <a class="struct" href="../frame/struct.PhysFrame.html" title="struct x86_64::structures::paging::frame::PhysFrame">PhysFrame</a>&lt;S&gt;,
    flags: <a class="struct" href="../page_table/struct.PageTableFlags.html" title="struct x86_64::structures::paging::page_table::PageTableFlags">PageTableFlags</a>,
    frame_allocator: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;mut A</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.MapperFlush.html" title="struct x86_64::structures::paging::mapper::MapperFlush">MapperFlush</a>&lt;S&gt;, <a class="enum" href="enum.MapToError.html" title="enum x86_64::structures::paging::mapper::MapToError">MapToError</a>&lt;S&gt;&gt;<span class="where fmt-newline">where
    Self: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a> + <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;S&gt;,
    A: <a class="trait" href="../trait.FrameAllocator.html" title="trait x86_64::structures::paging::FrameAllocator">FrameAllocator</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,
    S: <a class="trait" href="../page/trait.PageSize.html" title="trait x86_64::structures::paging::page::PageSize">PageSize</a>,</span></h4></section></summary><div class="docblock"><p>Maps the given frame to the virtual page with the same address.</p>
<h6 id="safety-6"><a href="#safety-6">Safety</a></h6>
<p>This is a convencience function that invokes <a href="trait.Mapper.html#method.map_to" title="method x86_64::structures::paging::mapper::Mapper::map_to"><code>Mapper::map_to</code></a> internally, so
all safety requirements of it also apply for this function.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-Mapper%3CSize1GiB%3E-for-OffsetPageTable%3C'a%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/offset_page_table.rs.html#66-133">source</a><a href="#impl-Mapper%3CSize1GiB%3E-for-OffsetPageTable%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size1GiB.html" title="enum x86_64::structures::paging::page::Size1GiB">Size1GiB</a>&gt; for <a class="struct" href="struct.OffsetPageTable.html" title="struct x86_64::structures::paging::mapper::OffsetPageTable">OffsetPageTable</a>&lt;'a&gt;</h3></section><section id="impl-Mapper%3CSize1GiB%3E-for-RecursivePageTable%3C'a%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/recursive_page_table.rs.html#299-417">source</a><a href="#impl-Mapper%3CSize1GiB%3E-for-RecursivePageTable%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size1GiB.html" title="enum x86_64::structures::paging::page::Size1GiB">Size1GiB</a>&gt; for <a class="struct" href="struct.RecursivePageTable.html" title="struct x86_64::structures::paging::mapper::RecursivePageTable">RecursivePageTable</a>&lt;'a&gt;</h3></section><section id="impl-Mapper%3CSize2MiB%3E-for-OffsetPageTable%3C'a%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/offset_page_table.rs.html#135-202">source</a><a href="#impl-Mapper%3CSize2MiB%3E-for-OffsetPageTable%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size2MiB.html" title="enum x86_64::structures::paging::page::Size2MiB">Size2MiB</a>&gt; for <a class="struct" href="struct.OffsetPageTable.html" title="struct x86_64::structures::paging::mapper::OffsetPageTable">OffsetPageTable</a>&lt;'a&gt;</h3></section><section id="impl-Mapper%3CSize2MiB%3E-for-RecursivePageTable%3C'a%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/recursive_page_table.rs.html#419-572">source</a><a href="#impl-Mapper%3CSize2MiB%3E-for-RecursivePageTable%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size2MiB.html" title="enum x86_64::structures::paging::page::Size2MiB">Size2MiB</a>&gt; for <a class="struct" href="struct.RecursivePageTable.html" title="struct x86_64::structures::paging::mapper::RecursivePageTable">RecursivePageTable</a>&lt;'a&gt;</h3></section><section id="impl-Mapper%3CSize4KiB%3E-for-OffsetPageTable%3C'a%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/offset_page_table.rs.html#204-271">source</a><a href="#impl-Mapper%3CSize4KiB%3E-for-OffsetPageTable%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; for <a class="struct" href="struct.OffsetPageTable.html" title="struct x86_64::structures::paging::mapper::OffsetPageTable">OffsetPageTable</a>&lt;'a&gt;</h3></section><section id="impl-Mapper%3CSize4KiB%3E-for-RecursivePageTable%3C'a%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/recursive_page_table.rs.html#574-761">source</a><a href="#impl-Mapper%3CSize4KiB%3E-for-RecursivePageTable%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; for <a class="struct" href="struct.RecursivePageTable.html" title="struct x86_64::structures::paging::mapper::RecursivePageTable">RecursivePageTable</a>&lt;'a&gt;</h3></section><section id="impl-Mapper%3CSize1GiB%3E-for-MappedPageTable%3C'a,+P%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mapped_page_table.rs.html#150-256">source</a><a href="#impl-Mapper%3CSize1GiB%3E-for-MappedPageTable%3C'a,+P%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a, P: <a class="trait" href="trait.PageTableFrameMapping.html" title="trait x86_64::structures::paging::mapper::PageTableFrameMapping">PageTableFrameMapping</a>&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size1GiB.html" title="enum x86_64::structures::paging::page::Size1GiB">Size1GiB</a>&gt; for <a class="struct" href="struct.MappedPageTable.html" title="struct x86_64::structures::paging::mapper::MappedPageTable">MappedPageTable</a>&lt;'a, P&gt;</h3></section><section id="impl-Mapper%3CSize2MiB%3E-for-MappedPageTable%3C'a,+P%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mapped_page_table.rs.html#258-384">source</a><a href="#impl-Mapper%3CSize2MiB%3E-for-MappedPageTable%3C'a,+P%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a, P: <a class="trait" href="trait.PageTableFrameMapping.html" title="trait x86_64::structures::paging::mapper::PageTableFrameMapping">PageTableFrameMapping</a>&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size2MiB.html" title="enum x86_64::structures::paging::page::Size2MiB">Size2MiB</a>&gt; for <a class="struct" href="struct.MappedPageTable.html" title="struct x86_64::structures::paging::mapper::MappedPageTable">MappedPageTable</a>&lt;'a, P&gt;</h3></section><section id="impl-Mapper%3CSize4KiB%3E-for-MappedPageTable%3C'a,+P%3E" class="impl"><a class="src rightside" href="../../../../src/x86_64/structures/paging/mapper/mapped_page_table.rs.html#386-528">source</a><a href="#impl-Mapper%3CSize4KiB%3E-for-MappedPageTable%3C'a,+P%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a, P: <a class="trait" href="trait.PageTableFrameMapping.html" title="trait x86_64::structures::paging::mapper::PageTableFrameMapping">PageTableFrameMapping</a>&gt; <a class="trait" href="trait.Mapper.html" title="trait x86_64::structures::paging::mapper::Mapper">Mapper</a>&lt;<a class="enum" href="../page/enum.Size4KiB.html" title="enum x86_64::structures::paging::page::Size4KiB">Size4KiB</a>&gt; for <a class="struct" href="struct.MappedPageTable.html" title="struct x86_64::structures::paging::mapper::MappedPageTable">MappedPageTable</a>&lt;'a, P&gt;</h3></section></div><script src="../../../../trait.impl/x86_64/structures/paging/mapper/trait.Mapper.js" async></script></section></div></main></body></html>